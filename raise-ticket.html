<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Raise a Ticket</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">

  <!-- Optional: remove favicon 404 -->
  <link rel="icon" href="data:,">

  <style>
    * { box-sizing: border-box; }

    body{
      margin:0;
      padding:40px 20px;
      font-family:'Inter', sans-serif;

      /* IMPORTANT: this needs Flask route /assets/<file> (see app.py below) */
      background: url("/assets/image.jpg") no-repeat center center fixed;
      background-size: cover;

      color:#333;
      display:flex;
      flex-direction:column;
      align-items:center;
      min-height:100vh;
      overflow-x:hidden;
      position: relative;
    }

    body::before{
      content:'';
      position:fixed;
      inset:0;
      background: rgba(236,232,232,0.26);
      z-index:-1;
    }

    .home-btn{
      position:fixed;
      top:20px;
      left:20px;
      background: rgba(255,255,255,0.8);
      padding:10px 20px;
      border-radius:30px;
      border:1px solid #ccc;
      color:#333;
      text-decoration:none;
      font-weight:500;
      transition: all .3s ease;
      z-index:10;
    }
    .home-btn:hover{
      background:#007bff;
      color:#fff;
      box-shadow:0 0 12px rgba(0,123,255,.5);
    }

    .hero{
      text-align:center;
      margin-top:30px;
      margin-bottom:20px;
      width:100%;
    }
    .hero h1{
      background: linear-gradient(90deg, #02023d,#023075, #4e4ef8);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      font-weight:700;
      font-size:50px;
      text-shadow:10px 2px 8px rgba(0,0,0,.121);
      margin: 0;
      animation: fadeIn 1.2s ease-in-out;
    }
    @keyframes fadeIn{
      0%{opacity:0; transform: translateY(-10px);}
      100%{opacity:1; transform: translateY(0);}
    }

    .form-card{
      background: rgba(255,255,255,0.623);
      border-radius:20px;
      border:1px solid #60d9fb;
      padding:35px 30px;
      width:100%;
      max-width: 720px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.10);
      animation: fadeIn .8s ease-in-out;
    }

    label{
      display:block;
      margin-bottom:6px;
      font-size:16px;
      color:#1d1d1d;
      font-weight:800;
      text-shadow: rgba(255,255,255,.268) 2px 2px;
    }
    .req{
      color:#ff0000;
      margin-left:6px;
      font-weight:800;
    }

    input, select{
      width:100%;
      padding:14px 16px;
      margin-bottom:20px;
      background:#f9f9f99f;
      border:1px solid #31ccf7;
      border-color:#00b4db;
      border-radius:12px;
      color:#181717;
      font-size:15px;
      transition: all .3s ease;
    }
    select{
      background-color:#f9f9f996;
      color:#333;
      border:1px solid #118dfa;
    }

    input:focus, textarea:focus, select:focus{
      outline:none;
      border-color:#007bff;
      background-color:#ffffff;
      box-shadow:0 0 0 2px rgba(0,123,255,0.2);
    }

    input::placeholder, textarea::placeholder{
      color:#6f6d6d;
    }

    .custom-textarea{
      width:100%;
      height:150px;
      padding:12px;
      font-size:16px;
      border:1px solid #00b4db;
      border-radius:12px;
      resize: vertical;
      background:#fefeffab;
      color:#333;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      transition:border .3s ease;
      margin-bottom:20px;
    }

    /* Attach UI (keeps your 5-file logic) */
    .attachRow{
      display:flex;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .attachBtn{
      display:inline-block;
      padding:12px 18px;
      border:none;
      border-radius:30px;
      font-size:14px;
      font-weight:700;
      cursor:pointer;
      transition:.3s ease;
      background: rgba(255,255,255,0.85);
      border: 1px solid #00b4db;
      color:#004e92;
      user-select:none;
    }
    .attachBtn:hover{
      box-shadow:0 0 15px rgba(0,29,59,0.18);
      transform: scale(1.01);
    }
    .attachBtn[aria-disabled="true"]{
      opacity:.55;
      cursor:not-allowed;
      pointer-events:none;
    }
    .file-note{
      font-size:12px;
      color:#101010;
      margin-top:-10px;
      margin-bottom:15px;
    }

    .filesList{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-bottom:20px;
    }
    .fileItem{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border:1px solid #ccefff;
      border-radius:12px;
      background: rgba(255,255,255,0.75);
      font-size:13px;
    }
    .fileName{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      max-width: 100%;
    }
    .fileRemove{
      color:#fe6767;
      font-weight:900;
      cursor:pointer;
      text-decoration:none;
      flex:0 0 auto;
    }

    .btn-group{
      display:flex;
      justify-content:center;
      gap:15px;
      flex-wrap:wrap;
    }
    .btn-submit, .btn-reset{
      padding:12px 30px;
      border:none;
      border-radius:30px;
      font-size:15px;
      font-weight:bold;
      cursor:pointer;
      transition:.3s ease;
      min-width:120px;
    }
    .btn-submit{
      background: linear-gradient(90deg, #0101cf,#024dbf, #5757f7);
      color:#fff;
    }
    .btn-submit:hover{
      box-shadow:0 0 15px rgba(0,29,59,0.5);
      transform: scale(1.02);
    }
    .btn-reset{
      background:#f0f0f0;
      color:#fe6767;
      border:1px solid #ddd;
    }
    .btn-reset:hover{
      background:#e0e0e0;
      transform: scale(1.02);
    }

    @media (max-width: 768px){
      .form-card{ padding:30px 20px; }
      .hero h1{ font-size: 2.2rem; }
    }
    @media (max-width: 480px){
      .form-card{ padding:25px 15px; }
      input, select, textarea{ font-size:14px; padding:12px; }
      .btn-submit, .btn-reset{ width:100%; }
      .btn-group{ flex-direction:column; gap:10px; }
    }
  </style>
</head>

<body>

  <!-- Home Button -->
  <a href="/" class="home-btn">‚Üê Return to Home</a>


  <!-- Hero Section -->
  <div class="hero" data-aos="fade-down">
    <h1>Raise a Ticket</h1>
  </div>

  <!-- Form Section -->
  <div class="form-card" data-aos="fade-up">

    <form name="zsWebToCase_1143387000001276021"
          id="zsWebToCase_1143387000001276021"
          action="https://desk.zoho.com/support/WebToCase"
          method="POST"
          enctype="multipart/form-data"
          onsubmit="return zsValidateMandatoryFields();">

      <!-- Keep YOUR existing hidden token values -->
      <input type="hidden" name="xnQsjsdp" value="edbsn09a4f85ea235bc86c8c4c895589a8df4" />
      <input type="hidden" name="xmIwtLD" value="edbsnc270b248fbbf8316722a8888f6d0717a7e3dde56f571d36f14269f97cf36f418" />
      <input type="hidden" name="xJdfEaS" value="" />
      <input type="hidden" name="actionType" value="Q2FzZXM=" />
      <input type="hidden" name="returnURL" value="https://mycbhelp.com/" />

      <label>Contact Name <span class="req">*</span></label>
      <input type="text" name="Contact Name" maxlength="120" placeholder="Enter your full name" />

      <label>Email <span class="req">*</span></label>
      <input type="text" name="Email" maxlength="120" placeholder="you@example.com" />

      <label>Mobile Number <span class="req">*</span></label>
      <input type="text" name="Mobile Number" maxlength="120" placeholder="05XXXXXXXX" />

      <label>Select Your Team <span class="req">*</span></label>
      <select name="Select Your Team" id="CASECF2">
        <option value="">-- Select Team --</option>
        <option value="Off Plan Team">Off Plan Team</option>
        <option value="Commercial Team">Commercial Team</option>
        <option value="Praveen Team">Praveen Team</option>
        <option value="Ayman Team">Ayman Team</option>
        <option value="Business Bay Team">Business Bay Team</option>
        <option value="Global Luxury">Global Luxury</option>
        <option value="Dubai Marina Team">Dubai Marina Team</option>
        <option value="Conveyancing">Conveyancing</option>
      </select>

      <label>Select Your Request <span class="req">*</span></label>
      <select name="Select Your Request" id="CASECF1">
        <option value="">-- Select Request --</option>
      </select>

      <label>Subject <span class="req">*</span></label>
      <input type="text" name="Subject" maxlength="255" placeholder="Brief summary of your request" />

      <label>Description <span class="req">*</span></label>
      <textarea name="Description" maxlength="3000" class="custom-textarea" placeholder="Detailed description ..."></textarea>

      <label>Attachment (Max 5 files)</label>
      <div class="attachRow">
        <span id="attachBtn" class="attachBtn">Attach files</span>
        <div class="file-note">Each file must be less than 20MB</div>
      </div>

      <!-- Hidden file inputs (Zoho expects attachment_1..attachment_5) -->
      <input type="file" name="attachment_1" id="zsattachment_1" style="display:none" />
      <input type="file" name="attachment_2" id="zsattachment_2" style="display:none" />
      <input type="file" name="attachment_3" id="zsattachment_3" style="display:none" />
      <input type="file" name="attachment_4" id="zsattachment_4" style="display:none" />
      <input type="file" name="attachment_5" id="zsattachment_5" style="display:none" />

      <div id="filesList" class="filesList"></div>

      <div class="btn-group">
        <button type="submit" id="zsSubmitButton_1143387000001276021" class="btn-submit">Submit</button>
        <button type="button" class="btn-reset" onclick="zsResetWebForm('1143387000001276021')">Reset</button>
      </div>
    </form>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init();
  </script>

  <script>
    // -----------------------------
    // Team -> Request mapping
    // -----------------------------
    const DEFAULT_REQUESTS = [
      "Listing :: Create",
      "Listing :: Update",
      "Opportunity :: Create",
      "Opportunity :: Update",
      "Opportunity :: Relist",
      "Form :: Create",
      "Form :: Update",
      "Invoice :: Create",
      "Invoice :: Update",
      "Invoice :: Cancellation",
      "Open House :: Create",
      "Open House :: Update",
      "Portal :: Remove",
      "Escalations / Others"
    ];

    const CONVEYANCING_REQUESTS = [
      "Conveyancing :: Transfer property with Conveyancing",
      "Conveyancing :: NOC",
      "Conveyancing :: Deal Cancellation",
      "Conveyancing :: Others"
    ];

    function rebuildRequestOptions() {
      const teamSel = document.getElementById("CASECF2");
      const reqSel  = document.getElementById("CASECF1");
      const team = (teamSel.value || "").trim();

      const list = (team === "Conveyancing") ? CONVEYANCING_REQUESTS : DEFAULT_REQUESTS;

      reqSel.innerHTML = "";
      reqSel.appendChild(new Option("-- Select Request --", ""));

      if (!team) return;
      list.forEach(v => reqSel.appendChild(new Option(v, v)));
    }

    // -----------------------------
    // Mandatory validation
    // -----------------------------
    function zsValidateMandatoryFields(){
      const form = document.forms["zsWebToCase_1143387000001276021"];
      const submitBtn = document.getElementById("zsSubmitButton_1143387000001276021");

      const required = [
        { name: "Contact Name", label: "Contact Name" },
        { name: "Email", label: "Email", type: "email" },
        { name: "Mobile Number", label: "Mobile Number" },
        { name: "Select Your Team", label: "Select Your Team", type: "select" },
        { name: "Select Your Request", label: "Select Your Request", type: "select" },
        { name: "Subject", label: "Subject" },
        { name: "Description", label: "Description" }
      ];

      for (const f of required){
        const el = form[f.name];
        if (!el) continue;

        const val = (el.value || "").trim();

        if (f.type === "select") {
          if (!val) { alert(f.label + " cannot be empty"); el.focus(); return false; }
        } else {
          if (!val) { alert(f.label + " cannot be empty"); el.focus(); return false; }
        }

        if (f.type === "email") {
          const ok = /^([\w_][\w\-_.+\'&]*)@(?=.{4,256}$)(([\w]+)([\-_]*[\w])*[\.])+[a-zA-Z]{2,22}$/.test(val);
          if (!ok) { alert("Enter a valid email-Id"); el.focus(); return false; }
        }
      }

      if (submitBtn) submitBtn.disabled = true;
      return true;
    }

    // -----------------------------
    // Attachments (up to 5 files, each <= 20MB)
    // -----------------------------
    const MAX_FILES = 5;
    const MAX_MB = 20;

    let availableSlots = [1,2,3,4,5];
    let usedSlots = [];

    function bytesToMB(b){ return b / (1024*1024); }

    function refreshAttachBtn() {
      const btn = document.getElementById("attachBtn");
      const disabled = availableSlots.length === 0;
      btn.setAttribute("aria-disabled", disabled ? "true" : "false");
    }

    function renderFilesList() {
      const list = document.getElementById("filesList");
      list.innerHTML = "";

      usedSlots.forEach(slot => {
        const input = document.getElementById("zsattachment_" + slot);
        if (!input || !input.files || !input.files[0]) return;

        const file = input.files[0];

        const row = document.createElement("div");
        row.className = "fileItem";

        const name = document.createElement("div");
        name.className = "fileName";
        name.textContent = file.name;

        const remove = document.createElement("a");
        remove.className = "fileRemove";
        remove.href = "javascript:void(0)";
        remove.textContent = "X";
        remove.addEventListener("click", () => removeFile(slot));

        row.appendChild(name);
        row.appendChild(remove);
        list.appendChild(row);
      });
    }

    function removeFile(slot) {
      const input = document.getElementById("zsattachment_" + slot);
      if (input) input.value = "";

      usedSlots = usedSlots.filter(s => s !== slot);
      if (!availableSlots.includes(slot)) availableSlots.push(slot);
      availableSlots.sort((a,b) => a-b);

      renderFilesList();
      refreshAttachBtn();
    }

    function attachNextFile() {
      if (availableSlots.length === 0) return;
      const slot = availableSlots[0];
      const input = document.getElementById("zsattachment_" + slot);
      if (input) input.click();
    }

    function handleFileChange(slot) {
      const input = document.getElementById("zsattachment_" + slot);
      if (!input || !input.files || !input.files[0]) return;

      const file = input.files[0];
      if (bytesToMB(file.size) > MAX_MB) {
        alert("Maximum allowed file size is 20MB.");
        input.value = "";
        return;
      }

      availableSlots = availableSlots.filter(s => s !== slot);
      if (!usedSlots.includes(slot)) usedSlots.push(slot);
      usedSlots.sort((a,b) => a-b);

      renderFilesList();
      refreshAttachBtn();
    }

    function zsResetWebForm(webFormId) {
      const form = document.forms["zsWebToCase_" + webFormId];
      if (form) form.reset();

      rebuildRequestOptions();

      availableSlots = [1,2,3,4,5];
      usedSlots = [];
      for (let i=1;i<=MAX_FILES;i++){
        const input = document.getElementById("zsattachment_" + i);
        if (input) input.value = "";
      }
      renderFilesList();
      refreshAttachBtn();

      const submitBtn = document.getElementById("zsSubmitButton_1143387000001276021");
      if (submitBtn) submitBtn.disabled = false;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const teamSel = document.getElementById("CASECF2");
      if (teamSel) teamSel.addEventListener("change", rebuildRequestOptions);
      rebuildRequestOptions();

      document.getElementById("attachBtn").addEventListener("click", attachNextFile);
      for (let i=1;i<=MAX_FILES;i++){
        const input = document.getElementById("zsattachment_" + i);
        input.addEventListener("change", () => handleFileChange(i));
      }
      refreshAttachBtn();

      window.addEventListener("pageshow", () => {
        const submitBtn = document.getElementById("zsSubmitButton_1143387000001276021");
        if (submitBtn) submitBtn.disabled = false;
      });
    });
  </script>
</body>
</html>

